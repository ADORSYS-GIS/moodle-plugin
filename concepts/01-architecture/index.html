<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for the Moodle Plugin"><meta name=author content="Adorsys Team"><link href=../../what-is-moodle/ rel=prev><link href=../../guides/01-moodle-operation/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>Architecture - Moodle Plugin</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#architecture-overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Moodle Plugin" class="md-header__button md-logo" aria-label="Moodle Plugin" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Moodle Plugin </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Architecture </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ADORSYS-GIS/moodle-plugin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ADORSYS-GIS/moodle-plugin </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Moodle Plugin" class="md-nav__button md-logo" aria-label="Moodle Plugin" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Moodle Plugin </label> <div class=md-nav__source> <a href=https://github.com/ADORSYS-GIS/moodle-plugin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> ADORSYS-GIS/moodle-plugin </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../features/ class=md-nav__link> <span class=md-ellipsis> Features </span> </a> </li> <li class=md-nav__item> <a href=../../what-is-moodle/ class=md-nav__link> <span class=md-ellipsis> What is Moodle </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Architecture </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-logical-components class=md-nav__link> <span class=md-ellipsis> 1. Logical Components </span> </a> </li> <li class=md-nav__item> <a href=#2-component-descriptions class=md-nav__link> <span class=md-ellipsis> 2. Component Descriptions </span> </a> <nav class=md-nav aria-label="2. Component Descriptions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-api-gateway-ingress class=md-nav__link> <span class=md-ellipsis> 2.1 API Gateway / Ingress </span> </a> </li> <li class=md-nav__item> <a href=#22-kubernetes-cluster-with-optional-knative class=md-nav__link> <span class=md-ellipsis> 2.2 Kubernetes Cluster (with optional Knative) </span> </a> </li> <li class=md-nav__item> <a href=#23-moodle-web-tier-moodle-web-tier class=md-nav__link> <span class=md-ellipsis> 2.3 Moodle Web Tier Moodle Web Tier </span> </a> </li> <li class=md-nav__item> <a href=#24-rust-operator class=md-nav__link> <span class=md-ellipsis> 2.4 Rust Operator </span> </a> </li> <li class=md-nav__item> <a href=#25-terraform-infrastructure class=md-nav__link> <span class=md-ellipsis> 2.5 Terraform &amp; Infrastructure </span> </a> </li> <li class=md-nav__item> <a href=#26-data-persistence-data-persistence class=md-nav__link> <span class=md-ellipsis> 2.6 Data Persistence Data Persistence </span> </a> </li> <li class=md-nav__item> <a href=#27-backup-jobs class=md-nav__link> <span class=md-ellipsis> 2.7 Backup &amp; Jobs </span> </a> </li> <li class=md-nav__item> <a href=#28-ai-inference-kserve class=md-nav__link> <span class=md-ellipsis> 2.8 AI Inference (KServe) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-deployment-models class=md-nav__link> <span class=md-ellipsis> 3. Deployment Models </span> </a> </li> <li class=md-nav__item> <a href=#4-architecture-diagram class=md-nav__link> <span class=md-ellipsis> 4. Architecture Diagram </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/01-moodle-operation/ class=md-nav__link> <span class=md-ellipsis> Moodle Operation </span> </a> </li> <li class=md-nav__item> <a href=../../guides/02-local-moodle-with-docker/ class=md-nav__link> <span class=md-ellipsis> Local Moodle with Docker </span> </a> </li> <li class=md-nav__item> <a href=../../guides/03-online-moodle-with-k8s/ class=md-nav__link> <span class=md-ellipsis> Online Moodle with k8s </span> </a> </li> <li class=md-nav__item> <a href=../../guides/04-k8s-operator-model/ class=md-nav__link> <span class=md-ellipsis> k8s Operator Model </span> </a> </li> <li class=md-nav__item> <a href=../../guides/05-moodle-optimisations-with-rust/ class=md-nav__link> <span class=md-ellipsis> Moodle Optimisations with Rust </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-logical-components class=md-nav__link> <span class=md-ellipsis> 1. Logical Components </span> </a> </li> <li class=md-nav__item> <a href=#2-component-descriptions class=md-nav__link> <span class=md-ellipsis> 2. Component Descriptions </span> </a> <nav class=md-nav aria-label="2. Component Descriptions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-api-gateway-ingress class=md-nav__link> <span class=md-ellipsis> 2.1 API Gateway / Ingress </span> </a> </li> <li class=md-nav__item> <a href=#22-kubernetes-cluster-with-optional-knative class=md-nav__link> <span class=md-ellipsis> 2.2 Kubernetes Cluster (with optional Knative) </span> </a> </li> <li class=md-nav__item> <a href=#23-moodle-web-tier-moodle-web-tier class=md-nav__link> <span class=md-ellipsis> 2.3 Moodle Web Tier Moodle Web Tier </span> </a> </li> <li class=md-nav__item> <a href=#24-rust-operator class=md-nav__link> <span class=md-ellipsis> 2.4 Rust Operator </span> </a> </li> <li class=md-nav__item> <a href=#25-terraform-infrastructure class=md-nav__link> <span class=md-ellipsis> 2.5 Terraform &amp; Infrastructure </span> </a> </li> <li class=md-nav__item> <a href=#26-data-persistence-data-persistence class=md-nav__link> <span class=md-ellipsis> 2.6 Data Persistence Data Persistence </span> </a> </li> <li class=md-nav__item> <a href=#27-backup-jobs class=md-nav__link> <span class=md-ellipsis> 2.7 Backup &amp; Jobs </span> </a> </li> <li class=md-nav__item> <a href=#28-ai-inference-kserve class=md-nav__link> <span class=md-ellipsis> 2.8 AI Inference (KServe) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-deployment-models class=md-nav__link> <span class=md-ellipsis> 3. Deployment Models </span> </a> </li> <li class=md-nav__item> <a href=#4-architecture-diagram class=md-nav__link> <span class=md-ellipsis> 4. Architecture Diagram </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=architecture-overview>Architecture Overview</h1> <p>This document provides a high-level view of the <strong>Moodle Platform</strong> architecture, showing how all components interact across different deployment models.</p> <hr> <h2 id=1-logical-components>1. Logical Components</h2> <p>This architecture directs incoming traffic from end users through an API Gateway into our Kubernetes cluster. Inside the cluster, we deploy the Moodle web tier, run our Rust operator, and optionally host AI inference services, while all persistent state (databases, object storage) and batch operations (backups, cron jobs) are managed externally or via dedicated K8s primitives.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>graph TD
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    A[End Users] --&gt; B[API Gateway / Ingress]
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    B --&gt; C[Kubernetes Cluster]
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    C --&gt; D[&quot;Moodle Web (Deployment)&quot;]
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    D --&gt; E[Redis Cache &amp; Sessions]
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    C --&gt; F[&quot;Moodle Operator (Rust)&quot;]
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    C --&gt; R[&quot;AI Inference (KServe, optional)&quot;]
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    F --&gt; G[Control Plane: CRDs &amp; Helm Charts]
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    G --&gt; H[Terraform IaC]
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    H --&gt; J[Compute Layer]
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    subgraph Compute Layer
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        J --&gt; K[Moodle Deployments]
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        J --&gt; L[&quot;Knative Services (optional)&quot;]
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>        J --&gt; R
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    end
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>    H --&gt; S[Data Persistence]
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    subgraph Data Persistence
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>        S --&gt; T[RDS / CloudSQL]
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        S --&gt; U[&quot;Object Store (S3/GCS)&quot;]
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>    end
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>    H --&gt; V[Backup &amp; Jobs]
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>subgraph Backup &amp; Jobs
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>V --&gt; W[CronJobs / Eventing]
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>V --&gt; X[Rust Backup CLI]
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>end
</code></pre></div> <hr> <h2 id=2-component-descriptions>2. Component Descriptions</h2> <h3 id=21-api-gateway-ingress>2.1 API Gateway / Ingress</h3> <ul> <li><strong>Role</strong>: Terminates TLS, routes to Knative or k8s Deployments.</li> <li><strong>Options</strong>: Istio, Contour, Kourier, AWS ALB.</li> </ul> <h3 id=22-kubernetes-cluster-with-optional-knative>2.2 Kubernetes Cluster (with optional Knative)</h3> <ul> <li><strong>Stateless Workloads</strong>: Moodle web Deployments (PHP-FPM), optional Knative Services, Rust micro‑services.</li> <li><strong>Stateful or Control Workloads</strong>: Rust operator Deployment, CronJobs, KServe inference pods.</li> <li><strong>Networking</strong>: One IngressController (Nginx, Istio, Traefik) exposed by the API Gateway.</li> </ul> <h3 id=23-moodle-web-tier-moodle-web-tier>2.3 Moodle Web Tier Moodle Web Tier</h3> <ul> <li><strong>PHP-FPM</strong> behind Nginx (or Apache): serves web UI.</li> <li><strong>ObjectFS Plugin</strong>: abstracts filesystem to S3/GCS.</li> </ul> <h3 id=24-rust-operator>2.4 Rust Operator</h3> <ul> <li><strong>Custom Resource Definitions (CRDs)</strong>: <code>MoodleCluster</code>, <code>MoodleBackup</code>, <code>MoodleScalePolicy</code>.</li> <li><strong>Responsibilities</strong>:</li> <li>Provision &amp; reconcile Knative Services or k8s Deployments.</li> <li>Manage Helm releases via the Go-Helm SDK (FFI layer in Rust).</li> <li>Watch DB credentials in AWS SM / Vault and rotate if needed.</li> </ul> <h3 id=25-terraform-infrastructure>2.5 Terraform &amp; Infrastructure</h3> <ul> <li><strong>Terraform Modules</strong>: reusable modules for VPC, Kubernetes clusters, managed DB replicas, and object stores; see <a href=setup/terraform.md>docs/setup/terraform.md</a> for detailed module layout and usage.</li> <li><strong>Module Structure Example</strong>:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>infra/terraform/
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>├── modules/
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>│   ├── vpc/
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>│   ├── k8s-cluster/
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>│   └── db-replica/
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>├── environments/
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>│   ├── staging/
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>│   └── production/
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>└── backend.tf
</code></pre></div> <ul> <li><strong>State Backend</strong>: remote state stored in S3 (or GCS) with DynamoDB locking (or Cloud KMS encryption).</li> </ul> <h3 id=26-data-persistence-data-persistence>2.6 Data Persistence Data Persistence</h3> <ul> <li><strong>Databases</strong>: Managed PostgreSQL/MySQL.</li> <li><strong>File Storage</strong>: S3/GCS-backed via Moodle’s ObjectFS.</li> <li><strong>Cache &amp; Sessions</strong>: External Redis or Memcached cluster.</li> </ul> <h3 id=27-backup-jobs>2.7 Backup &amp; Jobs</h3> <ul> <li><strong>Rust Backup CLI</strong>: schedules and performs snap‑style backups of DB and object store.</li> <li><strong>CronJobs / Knative Eventing</strong>: orchestrates periodic tasks.</li> </ul> <h3 id=28-ai-inference-kserve>2.8 AI Inference (KServe)</h3> <ul> <li><strong>Role</strong>: Hosts machine learning models for features like adaptive learning suggestions, content tagging, and personalized recommendations.</li> <li><strong>Integration</strong>: Deployed as a KServe <code>InferenceService</code> CRD on the Kubernetes cluster alongside Moodle services.</li> <li><strong>Workload Types</strong>:</li> <li><strong>CPU inference</strong> for lightweight models (e.g., logistic regression, decision trees).</li> <li> <p><strong>GPU inference</strong> for deep learning models (e.g., BERT, CNNs) via GPU-enabled nodes.</p> </li> <li> <p><strong>Model Versioning &amp; Rollouts</strong>:</p> </li> <li>Store model artifacts in object storage (S3/GCS) with semantic versioning (e.g., <code>model:v1.2.0</code>).</li> <li>Define KServe <code>CanaryRollout</code> policy to gradually shift traffic from the old revision to the new one.</li> <li> <p>Monitor inference metrics (latency, error rate) via Prometheus before promoting the new model.</p> </li> <li> <p><strong>Storage</strong>: Model artifacts pulled at start-up via InitContainers; cached on local PVC for fast warm starts.</p> </li> <li><strong>Autoscaling &amp; Scaling Policies</strong>:</li> <li>KServe’s built-in autoscaler adjusts replica count based on request rate and GPU utilization.</li> <li>Configure <code>minReplicas</code> and <code>maxReplicas</code> to control cost and SLA.</li> </ul> <hr> <h2 id=3-deployment-models>3. Deployment Models</h2> <blockquote> <p><strong>Primary Target:</strong> A non-serverless setup using pure Kubernetes with HPA &amp; StatefulSets remains our recommended default for production workloads.</p> </blockquote> <table> <thead> <tr> <th>Model</th> <th>Description</th> <th>Pros</th> <th>Cons</th> </tr> </thead> <tbody> <tr> <td>🐳 Pure Kubernetes</td> <td>k8s Deployments + HPA; StatefulSets for DB &amp; storage</td> <td>Production-ready, full control, rich ecosystem</td> <td>Operational complexity, setup overhead</td> </tr> <tr> <td>☁️ Cloud-Native Managed</td> <td>EKS/GKE + RDS + ElastiCache/Memorystore + Secrets Manager</td> <td>Simplified operations, auto-managed upgrades, high SLA</td> <td>Vendor lock-in, can be costlier</td> </tr> <tr> <td>📦 Container-Only</td> <td>Docker Compose or ECS Fargate with external services</td> <td>Fast provisioning, low orchestration footprint</td> <td>Limited autoscaling, manual infra updates</td> </tr> <tr> <td>🏗️ Bare Metal</td> <td>VMs or bare-metal servers running Docker or k3s</td> <td>Maximum performance, no virtualization overhead</td> <td>High ops burden, low elasticity</td> </tr> <tr> <td>🌐 Serverless (Optional)</td> <td>Knative Services for web &amp; micro-services</td> <td>Scale-to-zero, cost-efficient for low-traffic demos/tenants</td> <td>Cold-start latency, limited stateful support</td> </tr> </tbody> </table> <hr> <h2 id=4-architecture-diagram>4. Architecture Diagram</h2> <p>Below is a PlantUML diagram illustrating the high-level system, including client apps, external services, and key cluster components.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>graph TD
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>  subgraph &quot;External Services&quot;
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    RDS[&quot;RDS / CloudSQL&quot;]
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    OS[&quot;Object Store (S3/GCS)&quot;]
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>  end
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>  subgraph &quot;Kubernetes Cluster&quot;
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    MW[&quot;Moodle Web (Deployment)&quot;]
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    RD[&quot;Redis Cache &amp; Sessions&quot;]
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    OP[&quot;Moodle Operator (Rust)&quot;]
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>    AI[&quot;AI Inference (KServe, optional)&quot;]
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    CJ[&quot;CronJobs / Eventing&quot;]
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    BK[&quot;Rust Backup CLI&quot;]
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>  end
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>  EU[&quot;End Users&quot;] --&gt; AGW[&quot;API Gateway / Ingress&quot;]
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>  AGW --&gt; K8S{&quot;Kubernetes Cluster&quot;}
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>  K8S --&gt; MW
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>  MW --&gt; RD
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>  K8S --&gt; OP
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>  K8S --&gt; AI
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>  K8S --&gt; CJ
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>  K8S --&gt; BK
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>  RDS --&gt; MW -- Data --&gt; OS
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>  OS --&gt; MW
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>  OP --&gt; RDS -- Config --&gt; OS
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>  OS --&gt; OP
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>  AI --&gt; OS -- Model Artifacts --&gt; RDS
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>  OS --&gt; AI
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 14, 2025 10:54:12 UTC">July 14, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 14, 2025 10:54:12 UTC">July 14, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "navigation.top", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.56ea9cef.min.js></script> </body> </html>